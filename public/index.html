<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>GeekzPay REST API Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <style>
    :root { color-scheme: dark; }
    html, body { max-width:100%; overflow-x:hidden; }
    html { background:#0f172a; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial; color:#e2e8f0; }
    .flex > * { min-width: 0; }
    .grid > * { min-width: 0; }
    p code, li code, td code, th code, h1 code, h2 code, h3 code, a code { overflow-wrap: anywhere; word-break: break-word; }
    pre { margin:0; }
    pre code { font-size:.92rem; white-space: pre-wrap; word-break: break-word; }
    img { max-width:100%; height:auto; }
    table { width:100%; border-collapse:separate; border-spacing:0; table-layout: fixed; }
    .input, .select, .textarea { font-size:16px; min-width:0; width:100%; }
    @media (max-width:480px){
      pre code { font-size:.86rem; }
      .btn { padding:.75rem 1rem; font-size:.95rem; }
    }
  </style>
</head>
<body class="bg-slate-900 text-slate-100">
  <header class="sticky top-0 z-40 border-b border-slate-800 bg-slate-900/90 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <button id="openMenu" class="md:hidden p-2 rounded-lg border border-slate-700" aria-label="Buka menu">‚ò∞</button>
      <div class="flex items-center gap-2">
        <span class="text-lg font-semibold">üìò GeekzPay REST API</span>
        <span class="text-xs ml-2 px-2 py-0.5 rounded bg-indigo-500/15 text-indigo-300 border border-indigo-500/30">Docs</span>
      </div>
      <span class="text-sm text-slate-400 hidden sm:block">v1</span>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-4 w-full max-w-full">
    <div class="flex w-full">
      <aside class="hidden md:block w-64 shrink-0 pr-6 py-8">
        <nav class="space-y-3 text-sm">
          <a href="#setup" class="block hover:underline">‚öôÔ∏è Setup</a>
          <a href="#auth" class="block hover:underline">üîë Autentikasi</a>
          <a href="#qris" class="block hover:underline">1. QRIS Dinamis</a>
          <a href="#webhook" class="block hover:underline">2. Webhook Payment</a>
          <a href="#history" class="block hover:underline">3. Riwayat Webhook</a>
          <a href="#examples" class="block hover:underline">üì¶ Contoh cURL & Response</a>
        </nav>
      </aside>

      <main class="flex-1 py-8 md:py-10">
        <section id="setup" class="section mb-8">
          <h2 class="text-xl md:text-2xl font-semibold mb-3">‚öôÔ∏è Setup</h2>
          <div class="rounded-2xl border border-slate-800 bg-slate-900 p-4 grid gap-3 md:grid-cols-2">
            <label class="block">
              <span class="text-sm text-slate-300">Base URL API</span>
              <input id="baseUrl"
                     value="https://restapi-geekzpay.vercel.app"
                     class="input mt-1 px-3 py-2 rounded-lg border border-slate-700 bg-slate-800 text-slate-100"
                     placeholder="https://restapi-geekzpay.vercel.app" inputmode="url" />
            </label>
            <div class="flex items-end gap-2">
              <button id="saveBase" class="btn px-4 py-2 rounded-lg bg-indigo-600 text-white">Simpan</button>
              <button id="useLocal" class="btn px-4 py-2 rounded-lg bg-slate-800 border border-slate-700">Pakai origin</button>
            </div>
            <p class="text-xs text-slate-400 md:col-span-2">
              Base URL adalah alamat server API kamu. Form <b>Live Test</b> menembak endpoint ke alamat ini.
            </p>
          </div>
        </section>

        <section id="auth" class="section mb-10">
          <h2 class="text-xl md:text-2xl font-semibold mb-3">üîë Autentikasi</h2>
          <p class="text-sm md:text-base">Endpoint <code>/webhook/payment</code> membutuhkan <code>token</code>:</p>
          <ul class="list-disc ml-6 mt-2 space-y-1 text-sm md:text-base">
            <li>Query: <code>?token=USER123</code></li>
            <li>Header: <code>X-Webhook-Token: USER123</code></li>
            <li>Body JSON: <code>{ "token": "USER123" }</code></li>
          </ul>
        </section>

        <section id="qris" class="section mb-12">
          <h2 class="text-xl md:text-2xl font-semibold mb-3">1) QRIS Dinamis</h2>
          <p class="text-sm md:text-base mb-3"><code>POST /qris/dynamic</code></p>
          <div class="rounded-2xl border border-slate-800 bg-slate-900 p-4 space-y-3">
            <h3 class="font-medium">üß™ Live Test ‚Äî /qris/dynamic</h3>
            <label class="block mb-2 text-sm">Isi form dan kirim request untuk generate QR dinamis.</label>
            <div class="grid gap-3 md:grid-cols-2">
              <input id="tiBase" placeholder="base_amount" class="input px-3 py-2 rounded-lg border border-slate-700 bg-slate-800 text-slate-100">
              <input id="tiUnique" placeholder="unique_code" class="input px-3 py-2 rounded-lg border border-slate-700 bg-slate-800 text-slate-100">
              <input id="tiAmount" placeholder="amount" class="input md:col-span-2 px-3 py-2 rounded-lg border border-slate-700 bg-slate-800 text-slate-100">
            </div>
            <button id="btnDynamic" class="btn px-4 py-2 rounded-lg bg-indigo-600 text-white">Kirim</button>
            <div id="outDynamic" class="hidden mt-3">
              <pre><code id="jsonDynamic" class="language-json"></code></pre>
              <img id="imgQR" class="mt-3 rounded-lg border border-slate-700" />
            </div>
          </div>
        </section>

        <section id="webhook" class="section mb-12">
          <h2 class="text-xl md:text-2xl font-semibold mb-3">2) Webhook Payment</h2>
          <p class="text-sm md:text-base mb-3"><code>POST /webhook/payment</code></p>
          <div class="rounded-2xl border border-slate-800 bg-slate-900 p-4">
            <h3 class="font-medium">üß™ Live Test ‚Äî /webhook/payment</h3>
            <input id="tiToken" placeholder="Token" class="input mb-2 px-3 py-2 rounded-lg border border-slate-700 bg-slate-800 text-slate-100">
            <textarea id="tiBody" rows="3" class="textarea px-3 py-2 rounded-lg border border-slate-700 bg-slate-800 text-slate-100">{ "message": "Pembayaran masuk Rp 9.999 dari ShopeePay" }</textarea>
            <button id="btnWebhook" class="btn mt-2 px-4 py-2 rounded-lg bg-indigo-600 text-white">Kirim</button>
            <div id="outWebhook" class="hidden mt-3">
              <pre><code id="jsonWebhook" class="language-json"></code></pre>
            </div>
          </div>
        </section>

        <section id="history" class="section mb-12">
          <h2 class="text-xl md:text-2xl font-semibold mb-3">3) Riwayat Webhook</h2>
          <div class="overflow-x-auto rounded-2xl border border-slate-800 bg-slate-900">
            <table class="min-w-full text-left text-sm md:text-base">
              <thead class="text-slate-300"><tr><th class="py-2 px-3">Endpoint</th><th class="py-2 px-3">Contoh</th></tr></thead>
              <tbody class="divide-y divide-slate-800">
                <tr><td class="py-2 px-3">Summary</td><td class="py-2 px-3"><code>GET /webhook/summary?token=USER123&amp;limit=5</code></td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <section id="examples" class="section mb-16">
          <h2 class="text-xl md:text-2xl font-semibold mb-3">üì¶ Contoh cURL & Response</h2>
          <h3 class="font-medium mt-6 mb-2">/webhook/summary</h3>
          <pre class="overflow-x-auto rounded-xl bg-slate-800 p-4"><code class="language-bash">curl 'https://restapi-geekzpay.vercel.app/webhook/summary?token=USER123&amp;limit=5'</code></pre>
          <pre class="overflow-x-auto rounded-xl bg-slate-800 p-4 mt-2"><code class="language-json">{
  "ok": true,
  "token": "USER123",
  "count": 1,
  "events": [
    {
      "id": "ab12cd34ef56...",
      "time": "2025-09-23T19:28:09.212Z",
      "amount": 2969,
      "ip": "203.0.113.45",
      "method": "POST"
    }
  ]
}</code></pre>
        </section>
      </main>
    </div>
  </div>

  <!-- Back to top (mobile) -->
  <button id="toTop" class="fixed bottom-5 right-5 md:hidden rounded-full bg-indigo-600 text-white px-4 py-2 shadow-lg hidden">Top</button>

  <script>
  hljs.highlightAll();

  // Drawer Mobile (tetap)
  const drawer = document.getElementById('drawer');
  document.getElementById('openMenu').addEventListener('click', () => drawer.classList.remove('hidden'));
  document.getElementById('closeMenu').addEventListener('click', () => drawer.classList.add('hidden'));
  drawer.addEventListener('click', (e) => { if (e.target === drawer.firstElementChild) drawer.classList.add('hidden'); });
  drawer.querySelectorAll('[data-close]').forEach(a => a.addEventListener('click', () => drawer.classList.add('hidden')));

  // Back to top (tetap)
  const toTop = document.getElementById('toTop');
  const toggleTop = () => { if (window.scrollY > 400) toTop.classList.remove('hidden'); else toTop.classList.add('hidden'); };
  window.addEventListener('scroll', toggleTop);
  toTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  /* ===== Base URL helpers =====
     Jika domain mengandung "vercel.app" ‚Üí default pakai origin (proxy Vercel).
     Selain itu ‚Üí default ke Replit. */
  const baseInput = document.getElementById('baseUrl');
  const saveBase = document.getElementById('saveBase');
  const useLocal = document.getElementById('useLocal');

  function defaultBase() {
  return window.location.origin;
}
  function getBase(){
    const v = (localStorage.getItem('geekzpay_base') || '').trim();
    return v || defaultBase();
  }
  function setBase(v){ localStorage.setItem('geekzpay_base', v); }
  baseInput.value = getBase();
  saveBase.onclick = () => { setBase(baseInput.value.trim() || defaultBase()); alert('Base URL disimpan'); };
  useLocal.onclick = () => { const o = window.location.origin; baseInput.value = o; setBase(o); };

  // Util tampilan hasil
  function showJSON(el, text) {
    try { el.textContent = JSON.stringify(JSON.parse(text), null, 2); }
    catch { el.textContent = text; }
    hljs.highlightElement(el);
  }

  /* ========== Live Test: /qris/dynamic ========== */
  const btnDyn = document.getElementById('btnDynamic');
  const btnDynReset = document.getElementById('btnDynamicReset');
  const outDyn = document.getElementById('outDynamic');
  const jsonDyn = document.getElementById('jsonDynamic');
  const metaDyn = document.getElementById('metaDynamic');
  const imgQR = document.getElementById('imgQR');
  function rand1to999(){ return Math.floor(Math.random()*999)+1; }

  btnDyn.addEventListener('click', async () => {
    const base = document.getElementById('tiBase').value.trim();
    const uniqIn = document.getElementById('tiUnique').value.trim();
    const auto = document.getElementById('tiAutoUnique').checked;
    const amount = document.getElementById('tiAmount').value.trim();
    const payloadStatic = document.getElementById('tiPayload').value.trim();

    const url = (baseInput.value || defaultBase()).replace(/\/$/, '') + '/qris/dynamic';
    const form = new URLSearchParams();

    if (amount) {
      form.append('amount', amount);
    } else {
      if (!base) { alert('Isi base_amount atau amount.'); return; }
      form.append('base_amount', base);
      const uniq = auto ? rand1to999() : (uniqIn || '');
      if (!uniq) { alert('unique_code wajib (atau centang auto random).'); return; }
      form.append('unique_code', uniq);
    }
    if (payloadStatic) form.append('payload_static', payloadStatic);
    form.append('qr', 'png');

    btnDyn.disabled = true; btnDyn.textContent = 'Mengirim...';
    try {
      const started = performance.now();
      const r = await fetch(url, {
        method:'POST',
        headers:{ 'Content-Type':'application/x-www-form-urlencoded' },
        body:form,
        mode: 'cors',
        credentials: 'omit',
      });
      const text = await r.text();
      const dur = Math.round(performance.now() - started);
      metaDyn.textContent = `Status: ${r.status} ‚Ä¢ ${dur} ms ‚Ä¢ ${url}`;
      showJSON(jsonDyn, text);

      try {
        const obj = JSON.parse(text);
        imgQR.src = obj.qr_png_data_url || '';
      } catch { imgQR.src = ''; }

      outDyn.classList.remove('hidden');
      window.scrollTo({ top: outDyn.offsetTop - 80, behavior: 'smooth' });
    } catch (err) {
      metaDyn.textContent = `Gagal fetch: ${url}`;
      showJSON(jsonDyn, String(err && err.message || err));
      imgQR.src = '';
      outDyn.classList.remove('hidden');
    } finally {
      btnDyn.disabled = false; btnDyn.textContent = 'Kirim';
    }
  });

  btnDynReset.addEventListener('click', () => {
    document.getElementById('tiBase').value = '';
    document.getElementById('tiUnique').value = '';
    document.getElementById('tiAutoUnique').checked = false;
    document.getElementById('tiAmount').value = '';
    document.getElementById('tiPayload').value = '';
    outDyn.classList.add('hidden');
  });

  /* ========== Live Test: /webhook/payment ========== */
  const btnWh = document.getElementById('btnWebhook');
  const btnWhReset = document.getElementById('btnWebhookReset');
  const outWh = document.getElementById('outWebhook');
  const jsonWh = document.getElementById('jsonWebhook');
  const metaWh = document.getElementById('metaWebhook');

  btnWh.addEventListener('click', async () => {
    const token = document.getElementById('tiToken').value.trim();
    const mode = document.getElementById('tiMode').value;
    const body = document.getElementById('tiBody').value;
    if (!token) { alert('Isi token.'); return; }

    const base = (baseInput.value || defaultBase()).replace(/\/$/, '');
    const url = `${base}/webhook/payment?token=${encodeURIComponent(token)}`;

    let headers = {};
    let payload;
    if (mode === 'json') {
      headers['Content-Type'] = 'application/json';
      try { JSON.parse(body); } catch { alert('Body bukan JSON valid'); return; }
      payload = body;
    } else if (mode === 'form') {
      headers['Content-Type'] = 'application/x-www-form-urlencoded';
      payload = new URLSearchParams(Object.entries({ message: body }));
    } else {
      headers['Content-Type'] = 'text/plain';
      payload = body;
    }

    btnWh.disabled = true; btnWh.textContent = 'Mengirim...';
    try {
      const started = performance.now();
      const r = await fetch(url, { method:'POST', headers, body: payload, mode:'cors', credentials:'omit' });
      const text = await r.text();
      const dur = Math.round(performance.now() - started);
      metaWh.textContent = `Status: ${r.status} ‚Ä¢ ${dur} ms ‚Ä¢ ${url}`;
      showJSON(jsonWh, text);
      outWh.classList.remove('hidden');
      window.scrollTo({ top: outWh.offsetTop - 80, behavior: 'smooth' });
    } catch (err) {
      metaWh.textContent = `Gagal fetch: ${url}`;
      showJSON(jsonWh, String(err && err.message || err));
      outWh.classList.remove('hidden');
    } finally {
      btnWh.disabled = false; btnWh.textContent = 'Kirim';
    }
  });

  btnWhReset.addEventListener('click', () => {
    document.getElementById('tiToken').value = '';
    document.getElementById('tiMode').value = 'json';
    document.getElementById('tiBody').value = '{ "message": "Pembayaran masuk Rp 10.338 dari ShopeePay INV001" }';
    outWh.classList.add('hidden');
  });
</script>
</body>
</html>